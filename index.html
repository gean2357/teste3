<!DOCTYPE html>
<html>
<head>
  <title>Air Draw - Dennis Secure Login</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    canvas { position: absolute; top: 0; left: 0; }
    video { transform: scaleX(-1); width: 100vw; height: 100vh; object-fit: cover; }
    #ui { 
      position: absolute; top: 20px; left: 20px; 
      color: white; font-family: sans-serif; z-index: 10;
      background: rgba(0,0,0,0.7); padding: 15px; border-radius: 8px;
    }
    #pass-display { color: #00FF00; font-weight: bold; font-size: 24px; }
  </style>
</head>
<body>
  <div id="ui">
    <b>Dennis - Login Biom√©trico</b><br>
    üëâ Passe o indicador 2x sobre os c√≠rculos<br>
    üîí Senha: <span id="pass-display">____</span><br>
    ‚å®Ô∏è Espa√ßo: Limpa tudo
  </div>
  <video id="webcam" autoplay playsinline style="display:none;"></video>
  <canvas id="output_canvas"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

  <script>
    const videoElement = document.getElementById('webcam');
    const canvasElement = document.getElementById('output_canvas');
    const canvasCtx = canvasElement.getContext('2d');
    
    let points = []; 
    let currentPass = "";
    const targetPass = "0001";

    // Configura√ß√£o do Teclado Redondo e Centralizado
    const keys = [];
    const radius = 45; // Tamanho maior
    const cols = 5;    // 5 colunas para ficar centralizado
    
    for(let i=0; i<10; i++) {
        keys.push({
            label: i.toString(),
            // Posicionamento abaixo do centro
            x: 0, // Ser√° calculado no onResults baseado no tamanho da tela
            y: 0,
            hits: 0,
            lastHitTime: 0
        });
    }

    function getDistance(p1, p2) {
      return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));
    }

    function onResults(handResults, faceResults) {
      const w = window.innerWidth;
      const h = window.innerHeight;
      canvasElement.width = w;
      canvasElement.height = h;

      canvasCtx.save();
      canvasCtx.clearRect(0, 0, w, h);
      canvasCtx.translate(w, 0);
      canvasCtx.scale(-1, 1);
      
      if (handResults.image) {
        canvasCtx.drawImage(handResults.image, 0, 0, w, h);
      }

      // 1. DESENHA A FACE (Est√©tica Dennis)
      if (faceResults && faceResults.multiFaceLandmarks) {
        for (const landmarks of faceResults.multiFaceLandmarks) {
          drawConnectors(canvasCtx, landmarks, FACEMESH_TESSELATION, {color: '#C0C0C070', lineWidth: 1});
          drawConnectors(canvasCtx, landmarks, FACEMESH_RIGHT_EYE, {color: '#FF3030'});
          drawConnectors(canvasCtx, landmarks, FACEMESH_LEFT_EYE, {color: '#FF3030'});
          drawConnectors(canvasCtx, landmarks, FACEMESH_FACE_OVAL, {color: '#E0E0E0'});
          drawConnectors(canvasCtx, landmarks, FACEMESH_LIPS, {color: '#E0E0E0'});
        }
      }

      // 2. DESENHA O TECLADO REDONDO (CENTRALIZADO)
      keys.forEach((key, i) => {
          // Ajusta posi√ß√£o dinamicamente (2 linhas de 5 n√∫meros)
          const row = Math.floor(i / 5);
          const col = i % 5;
          key.x = (w / 2) - (2.5 * 110) + (col * 110) + 55;
          key.y = (h / 2) + 100 + (row * 110);

          canvasCtx.beginPath();
          canvasCtx.arc(key.x, key.y, radius, 0, 2 * Math.PI);
          canvasCtx.fillStyle = key.hits > 0 ? "rgba(0, 255, 0, 0.6)" : "rgba(0, 255, 0, 0.2)";
          canvasCtx.strokeStyle = "#00FF00";
          canvasCtx.lineWidth = 3;
          canvasCtx.fill();
          canvasCtx.stroke();
          
          canvasCtx.save();
          canvasCtx.scale(-1, 1);
          canvasCtx.fillStyle = "white";
          canvasCtx.font = "bold 30px Arial";
          canvasCtx.textAlign = "center";
          canvasCtx.fillText(key.label, -key.x, key.y + 10);
          canvasCtx.restore();
      });

      // 3. LOGICA DA M√ÉO
      if (handResults.multiHandLandmarks) {
        for (const landmarks of handResults.multiHandLandmarks) {
          drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, {color: '#00FF00', lineWidth: 3});

          const indexTip = landmarks[8];
          const x = indexTip.x * w;
          const y = indexTip.y * h;
          
          // Colis√£o com C√≠rculos
          keys.forEach(key => {
              const distToKey = Math.sqrt(Math.pow(x - key.x, 2) + Math.pow(y - key.y, 2));
              if (distToKey < radius) {
                  const now = Date.now();
                  if (now - key.lastHitTime > 700) { 
                      key.hits++;
                      key.lastHitTime = now;
                      
                      if (key.hits >= 2) {
                          currentPass += key.label;
                          document.getElementById('pass-display').innerText = "*".repeat(currentPass.length);
                          key.hits = 0; 
                          
                          if (currentPass.length === 4) {
                              if (currentPass === targetPass) {
                                  window.location.href = "https://www.youtube.com";
                              } else {
                                  currentPass = "";
                                  document.getElementById('pass-display').innerText = "ERRO";
                                  setTimeout(() => document.getElementById('pass-display').innerText = "____", 1000);
                              }
                          }
                      }
                  }
              }
          });

          // Desenho (Pin√ßa)
          const thumbTip = landmarks[4];
          const distPinca = getDistance(thumbTip, indexTip);
          if (distPinca < 0.05) {
            points.push({x, y});
          } else if (points.length > 0 && points[points.length-1] !== null) {
            points.push(null);
          }
        }
      }

      // 4. DESENHA O RASTRO
      canvasCtx.beginPath();
      canvasCtx.lineWidth = 6;
      canvasCtx.strokeStyle = "#00FF00"; // Desenho agora tamb√©m √© verde
      canvasCtx.stroke();
      
      canvasCtx.restore();
    }

    const faceMesh = new FaceMesh({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`});
    faceMesh.setOptions({ maxNumFaces: 1, refineLandmarks: true, minDetectionConfidence: 0.5 });

    const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
    hands.setOptions({ maxNumHands: 1, minDetectionConfidence: 0.5 });

    let latestHandResults = {};
    hands.onResults(results => { latestHandResults = results; });
    faceMesh.onResults(results => { onResults(latestHandResults, results); });

    const camera = new Camera(videoElement, {
      onFrame: async () => {
        await hands.send({image: videoElement});
        await faceMesh.send({image: videoElement});
      },
      width: 1280, height: 720
    });
    camera.start();

    window.addEventListener('keydown', (e) => { 
        if(e.code === 'Space') {
            points = []; currentPass = "";
            document.getElementById('pass-display').innerText = "____";
            keys.forEach(k => k.hits = 0);
        }
    });
  </script>
</body>
</html>
